<!DOCTYPE html>

<html>
  <head>
    <%- include('partials/head.ejs') %>
  </head>

    <body>
        <header>    
            <%- include('partials/navbar.ejs') %>
        </header>

        <main style="margin-top: 50px;">
            <div class="container">
                <div class="row justify-content-sm-center h-100">
                    <%- include('partials/alerts.ejs') %>
                    <h2>Add weather field metadata</h2>
                    <div class="col-xxl-6 col-xl-6 col-lg-9 col-md-9 col-sm-12">
                        <form id="form-main">
                            <label for="">Name</label>
                            <input class="form-control" type="text" name="name" placeholder="Nome do campo" value="" />

                            <label for="">Description</label>
                            <input class="form-control" type="text" name="description" placeholder="Descrição" value="" />

                            <p>Authentication required to view on map:</p>
                            <input class="form-check-input" type="radio" id="yes" name="authRequired" value="true" />
                            <label for="yes">Yes</label>
                            <input class="form-check-input" type="radio" id="no" name="authRequired" value="false" />
                            <label for="no">No</label>
                        </form>
                        <br>

                        <label for="">Colours:</label>
                        <div class="clonable-block" data-toggle="cloner">
                            <div class="clonable" data-ss="1">
                                <form class="row d-flex flex-row align-items-center flex-wrap border border-1 p-2">
                                    <div class="col-md-3">
                                        <label class="clonable-increment-html" for="">Mínimo</label>
                                        <input id="min_4" type="number" class="form-control clonable-increment-id" placeholder="" name="min" value="" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="clonable-increment-html" for="">Máximo</label>
                                        <input id="max_1" type="number" class="form-control clonable-increment-id" placeholder="" name="max" value="" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="clonable-increment-html" for="">Cor</label>
                                        <input id="color_1" type="color" class="form-control clonable-increment-id" name="color" placeholder="#333333" value="" />
                                    </div>
                                    <div class="col-md-3">
                                        <label class="clonable-increment-html" for=""></label>
                                        <button class="btn btn-danger btn-sm clonable-button-close d-block">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                            <button class="clonable-button-add btn btn-secondary mt-3" type="button">Add rule</button>  
                        </div>

                        <div class="d-grid mt-2">
                            <button id="clicar" class="btn btn-primary btn-block ">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <%- include('partials/footer.ejs') %>
        </footer>
    </body>
    <%- include('partials/scripts.ejs') %>
    <script src="/js/jquery.cloner.min.js"></script>
    <script>
        $(document).ready(function() {
            $("#clicar").on("click", function (e) {
                const form = $("#form-main").get(0);
                const data = convertFormToJSON(form);
                data.colours = [];

                const colourForms = $(".clonable form");
                colorForms.each(function() { 
                    data.colours.push(convertFormToJSON($(this)));
                });
            });
                
            function convertFormToJSON(form) {
                const array = $(form).serializeArray();
                const json = {};
                $.each(array, function () {
                    json[this.name] = this.value || null;
                });
                return json;
            }
        });
    </script>
</html>